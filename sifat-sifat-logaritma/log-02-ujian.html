<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uji Langsung: Sifat-Sifat Logaritma</title>

    <script>
        // --- KONFIGURASI PENTING UNTUK HALAMAN INI ---
        const subMateriId = 'log_2';
        const thisStageId = 'ujian';
        const previousStageId = 'latihan3';
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxwtP8HaiUAQdEPuxKh-hQ9_3WlN0MHgaLtidS1XJykKU1tFmvF1exfdrgaZJY1rCs/exec";
        
        // --- KONFIGURASI TELEGRAM BOT ---
        // ‚ö†Ô∏è GANTI DENGAN TOKEN DAN CHAT ID ANDA ‚ö†Ô∏è
        const TELEGRAM_BOT_TOKEN = 'YOUR_BOT_TOKEN_HERE';
        const TELEGRAM_CHAT_ID = 'YOUR_CHAT_ID_HERE';
        // ----------------------------------------------

        window.addEventListener('DOMContentLoaded', function() {
            const loggedInUserData = sessionStorage.getItem('loggedInUser');
            if (!loggedInUserData) {
                alert("Akses ditolak. Silakan login terlebih dahulu.");
                window.location.href = '../../login.html';
                return;
            }
            if (previousStageId) {
                const prevStageKey = `progress_${subMateriId}_${previousStageId}`;
                const isPrevCompleted = localStorage.getItem(prevStageKey) === 'completed';
                if (!isPrevCompleted) {
                    alert("Akses ditolak. Selesaikan semua Latihan sebelumnya pada Peta Belajar.");
                    window.location.href = './index.html'; 
                    return;
                }
            }
            document.body.style.visibility = 'visible';
        });

        // --- FUNGSI KIRIM NOTIFIKASI KE TELEGRAM ---
        async function sendToTelegram(message) {
            if (!TELEGRAM_BOT_TOKEN || TELEGRAM_BOT_TOKEN === 'YOUR_BOT_TOKEN_HERE') {
                console.warn('‚ö†Ô∏è Token Telegram belum dikonfigurasi');
                return false;
            }
            
            try {
                const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                const result = await response.json();
                if (result.ok) {
                    console.log('‚úÖ Notifikasi berhasil dikirim ke Telegram');
                    return true;
                } else {
                    console.error('‚ùå Gagal mengirim ke Telegram:', result.description);
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Error saat mengirim ke Telegram:', error);
                return false;
            }
        }

        function formatTelegramMessage(userData, level, score, passed, status) {
            const emoji = passed ? '‚úÖ' : '‚ùå';
            const statusEmoji = status === 'LULUS_LEVEL' ? 'üéâ' : 
                               status === 'GUGUR' ? 'üíî' : 
                               status === 'SELESAI_SEMUA' ? 'üèÜ' : 'üìù';
            
            let message = `${statusEmoji} <b>HASIL UJIAN LOGARITMA</b> ${statusEmoji}\n\n`;
            message += `üë§ <b>Nama:</b> ${userData.name || 'Unknown'}\n`;
            message += `üìß <b>Email:</b> ${userData.email || 'Unknown'}\n`;
            message += `üìä <b>Level:</b> ${level}\n`;
            message += `${emoji} <b>Status:</b> ${passed ? 'LULUS' : 'GAGAL'}\n`;
            message += `üíØ <b>Skor:</b> ${score.toFixed(0)}%\n`;
            message += `‚úì <b>Benar:</b> ${Math.round((score / 100) * 5)} dari 5 soal\n\n`;
            
            message += `üìà <b>Statistik ${level}:</b>\n`;
            message += `   ‚Ä¢ Lulus: ${state.passCount[level]}/2\n`;
            message += `   ‚Ä¢ Sisa Percobaan: ${state.attempts[level]}\n`;
            message += `   ‚Ä¢ Gagal Beruntun: ${state.consecutiveFails[level]}/3\n\n`;
            
            if (status === 'GUGUR') {
                message += `‚ùå <b>STATUS: GUGUR</b>\n`;
                message += `Siswa telah ${state.consecutiveFails[level] >= 3 ? 'gagal 3x berturut-turut' : 'kehabisan percobaan'}\n`;
            } else if (status === 'LULUS_LEVEL') {
                message += `‚úÖ <b>Level ${level} selesai!</b>\n`;
                const nextLevel = level === 'LOTS' ? 'MOTS' : (level === 'MOTS' ? 'HOTS' : 'SELESAI');
                if (nextLevel !== 'SELESAI') {
                    message += `üîì Level ${nextLevel} telah terbuka\n`;
                }
            } else if (status === 'SELESAI_SEMUA') {
                message += `üèÜ <b>SELAMAT!</b>\n`;
                message += `Siswa telah menyelesaikan seluruh ujian Sifat-Sifat Logaritma!\n`;
            }
            
            message += `\n‚è∞ <b>Waktu:</b> ${new Date().toLocaleString('id-ID')}`;
            
            return message;
        }
    </script>
    <link rel="icon" type="image/png" href="../UMT-Logo - Copy.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
    </script>
    <style>
        :root {
            --dark-bg: #141414; --dark-card: #1f1f1f; --dark-border: #333;
            --text-light: #f0f0f0; --text-muted: #aaa; --accent-blue: #007bff;
            --accent-green: #28a745; --accent-red: #dc3545; --accent-yellow: #ffc107;
            --accent-teal: #50e3c2;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg); color: var(--text-light);
            min-height: 100vh; padding: 20px;
            visibility: hidden;
        }
        .container {
            max-width: 900px; margin: 0 auto; background: var(--dark-card);
            border-radius: 15px; padding: 30px; border: 1px solid var(--dark-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center; margin-bottom: 30px; padding-bottom: 15px;
            border-bottom: 2px solid var(--accent-blue);
        }
        .header h1 { color: var(--text-light); font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: var(--text-muted); font-size: 1.1em; }
        .progress-container { margin: 30px 0; padding: 20px; background: rgba(0,0,0,0.2); border: 1px solid var(--dark-border); border-radius: 15px; }
        .progress-steps { display: flex; justify-content: space-between; margin-bottom: 15px; position: relative; }
        .progress-steps::before { content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 4px; background: var(--dark-border); z-index: 0; }
        .progress-fill { position: absolute; top: 20px; left: 0; height: 4px; background: var(--accent-blue); transition: width 0.5s ease; z-index: 1; }
        .step { display: flex; flex-direction: column; align-items: center; z-index: 2; position: relative; }
        .step-circle { width: 40px; height: 40px; border-radius: 50%; background: var(--dark-border); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--text-muted); border: 3px solid var(--dark-border); margin-bottom: 8px; transition: all 0.3s; }
        .step.active .step-circle { background: var(--dark-card); border-color: var(--accent-blue); color: var(--accent-blue); transform: scale(1.2); }
        .step.completed .step-circle { background: var(--accent-green); border-color: var(--accent-green); color: white; }
        .step-label { font-size: 0.85em; color: var(--text-muted); font-weight: 600; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .stat-card { background: var(--dark-bg); border: 1px solid var(--dark-border); padding: 15px; border-radius: 12px; text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; color: var(--accent-teal); margin-bottom: 5px; }
        .stat-label { font-size: 0.9em; color: var(--text-muted); }
        .content-area { margin: 30px 0; min-height: 300px; }
        .question-card { padding: 25px; background: var(--dark-card); border-radius: 15px; margin-bottom: 20px; }
        .question-number { color: var(--accent-blue); font-weight: bold; margin-bottom: 15px; }
        .question-text { margin-bottom: 20px; font-size: 1.1em; line-height: 1.6; }
        .option { padding: 15px 20px; background: var(--dark-bg); border: 2px solid var(--dark-border); border-radius: 10px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; color: var(--text-muted); }
        .option:hover { border-color: var(--accent-blue); color: var(--text-light); background: #2a2a2a; }
        .option.selected { border-color: var(--accent-blue); background: rgba(0, 123, 255, 0.1); color: var(--text-light); }
        .option.correct { border-color: var(--accent-green); background: rgba(40, 167, 69, 0.2); color: #d4edda; }
        .option.incorrect { border-color: var(--accent-red); background: rgba(220, 53, 69, 0.2); color: #f8d7da; }
        .option input[type="radio"] { margin-right: 15px; }
        .btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-muted); padding: 12px 35px; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin: 10px 5px; text-decoration: none; display: inline-block; }
        .btn:hover { background: rgba(255, 255, 255, 0.1); color: var(--text-light); transform: translateY(-2px); }
        .btn-primary { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
        .btn-primary:hover { background: #0069d9; border-color: #0062cc; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; background: var(--dark-border); }
        .button-group { display: flex; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .explanation { background: #2a2a2a; padding: 15px; border-radius: 10px; margin-top: 20px; border: 1px solid #444; color: var(--text-muted); line-height: 1.7; overflow-x: auto; }
        .attempts-info { background-color: rgba(255, 193, 7, 0.1); border-left: 5px solid var(--accent-yellow); color: #fff3cd; padding: 15px; border-radius: 10px; margin: 15px 0; text-align: center; }
        .certificate { background: linear-gradient(135deg, #1f1f1f, #2a2a2a); color: white; padding: 40px; border-radius: 20px; text-align: center; margin: 30px 0; border: 2px solid var(--accent-teal); box-shadow: 0 0 40px rgba(80, 227, 194, 0.2); }
        #notification-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .notification { background-color: #2a2a2a; color: var(--text-light); padding: 15px 20px; border-radius: 8px; border-left: 5px solid; box-shadow: 0 5px 15px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease forwards, fadeOut 0.5s ease 3.5s forwards; }
        .notification.warning { border-color: var(--accent-yellow); }
        .notification.success { border-color: var(--accent-green); }
        .notification.info { border-color: var(--accent-blue); }
        @keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateY(20px); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Ujian: Sifat-Sifat Logaritma</h1>
            <p>Selesaikan setiap level untuk membuka level berikutnya.</p>
        </div>
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
                <div class="step completed" id="step0"><div class="step-circle">üìö</div><div class="step-label">Materi</div></div>
                <div class="step" id="step1"><div class="step-circle">1</div><div class="step-label">LOTS</div></div>
                <div class="step" id="step2"><div class="step-circle">2</div><div class="step-label">MOTS</div></div>
                <div class="step" id="step3"><div class="step-circle">3</div><div class="step-label">HOTS</div></div>
                <div class="step" id="step4"><div class="step-circle">üèÜ</div><div class="step-label">Selesai</div></div>
            </div>
            <div class="stats">
                <div class="stat-card"><div class="stat-value" id="currentLevel">LOTS</div><div class="stat-label">Level Saat Ini</div></div>
                <div class="stat-card"><div class="stat-value" id="attemptsLeft">5</div><div class="stat-label">Percobaan Tersisa</div></div>
                <div class="stat-card"><div class="stat-value" id="passCount">0/2</div><div class="stat-label">Kali Lulus</div></div>
            </div>
        </div>
        <div class="content-area" id="contentArea"></div>
    </div>

    <div id="notification-container"></div>
    
    <a href="./index.html" class="back-link" title="Kembali ke Peta Belajar">
       <i class="fas fa-arrow-left"></i>
    </a>
    
<script>
    async function markAsCompletedAndUnlockNext() {
        try {
            localStorage.setItem(`progress_${subMateriId}_${thisStageId}`, 'completed');
            console.log(`‚úÖ Ujian selesai! Progress disimpan: progress_${subMateriId}_${thisStageId}`);
            showNotification('Selamat! Sub-materi berikutnya telah terbuka!', 'success');
        } catch (error) {
            console.error("Gagal menyelesaikan sub-materi:", error);
            showNotification('Gagal menyimpan progres akhir.', 'warning');
        }
    }

    const state = { currentStage: 1, attempts: { LOTS: 5, MOTS: 5, HOTS: 5 }, passCount: { LOTS: 0, MOTS: 0, HOTS: 0 }, consecutiveFails: { LOTS: 0, MOTS: 0, HOTS: 0 }, currentQuiz: null, userAnswers: [], activeQuestions: [] };

    const quizContent = {
        // ... (Bank soal lengkap Anda ada di sini) ...
        // Saya akan menggunakan bank soal dari permintaan sebelumnya sebagai contoh
        LOTS: [
            { question: "Nilai dari \\( ^3\\log 9 + {^3\\log 3} \\) adalah...", options: [{ text: "3" }, { text: "2" }, { text: "4" }], correct: 0, explanation: "Gunakan sifat penjumlahan: \\( ^3\\log(9 \\times 3) = {^3\\log 27} \\). Jawabannya adalah 3." },
            { question: "Bentuk sederhana dari \\( ^5\\log 100 - {^5\\log 4} \\) adalah...", options: [{ text: "2" }, { text: "5" }, { text: "25" }], correct: 0, explanation: "Gunakan sifat pengurangan: \\( ^5\\log(100/4) = {^5\\log 25} \\). Jawabannya adalah 2." },
            { question: "Nilai dari \\( ^2\\log(8^3) \\) adalah...", options: [{ text: "9" }, { text: "6" }, { text: "8" }], correct: 0, explanation: "Gunakan sifat pangkat: \\( 3 \\cdot {^2\\log 8} = 3 \\cdot 3 = 9\\)." },
            { question: "Ekspresi \\( ^4\\log 5 + {^4\\log 3} \\) setara dengan...", options: [{ text: "\\( ^4\\log 15 \\)" }, { text: "\\( ^4\\log 8 \\)" }, { text: "\\( ^4\\log(5/3) \\)" }], correct: 0, explanation: "Sifat penjumlahan logaritma menjadi perkalian numerus: \\( ^4\\log (5 \\times 3) = {^4\\log 15}\\)." },
            { question: "Nilai dari \\( \\log 1000 \\) (basis 10) adalah...", options: [{ text: "3" }, { text: "2" }, { text: "10" }], correct: 0, explanation: "Jika basis tidak ditulis, artinya basis 10. \\(10^3 = 1000\\), maka jawabannya 3." },
            { question: "Hasil dari \\( ^a\\log(b) + {^a\\log(c)} \\) adalah...", options: [{ text: "\\( ^a\\log(bc) \\)" }, { text: "\\( ^a\\log(b+c) \\)" }, { text: "\\( ^a\\log(b/c) \\)" }], correct: 0, explanation: "Ini adalah bentuk umum dari sifat penjumlahan logaritma." },
            { question: "Nilai dari \\( ^9\\log 1 \\) adalah...", options: [{ text: "0" }, { text: "1" }, { text: "9" }], correct: 0, explanation: "Logaritma dari 1 dengan basis apapun yang valid selalu 0, karena \\(a^0=1\\)." },
            { question: "Bentuk sederhana dari \\( {^2\\log 16} \\) adalah...", options: [{ text: "4" }, { text: "8" }, { text: "2" }], correct: 0, explanation: "\\(2^4=16\\), maka jawabannya adalah 4." },
            { question: "Ekspresi \\( 2 \\cdot \\log x \\) setara dengan...", options: [{ text: "\\(\\log(x^2)\\)" }, { text: "\\((\\log x)^2\\)" }, { text: "\\(\\log(2x)\\)" }], correct: 0, explanation: "Sifat pangkat menyatakan koefisien bisa 'naik' menjadi pangkat bagi numerus." },
            { question: "Nilai dari \\( ^5\\log 5 \\) adalah...", options: [{ text: "1" }, { text: "0" }, { text: "5" }], correct: 0, explanation: "Setiap logaritma dengan basis dan numerus yang sama bernilai 1, karena \\(a^1=a\\)." },
            { question: "Bentuk sederhana dari \\( ^7\\log(1/49) \\) adalah...", options: [{ text: "-2" }, { text: "2" }, { text: "1/7" }], correct: 0, explanation: "\\( 1/49 = 1/7^2 = 7^{-2} \\). Maka, \\( ^7\\log(7^{-2}) = -2 \\)." },
            { question: "Sifat \\( ^a\\log(x/y) \\) adalah...", options: [{ text: "\\( ^a\\log x - {^a\\log y} \\)" }, { text: "\\( ^a\\log x / {^a\\log y} \\)" }, { text: "\\( ^a\\log(x-y) \\)" }], correct: 0, explanation: "Ini adalah bentuk umum dari sifat pengurangan logaritma." },
            { question: "Nilai dari \\( ^2\\log 2^5 \\) adalah...", options: [{ text: "5" }, { text: "2" }, { text: "10" }], correct: 0, explanation: "Gunakan sifat pangkat: \\( 5 \\cdot {^2\\log 2} = 5 \\cdot 1 = 5\\)." },
            { question: "Hasil dari \\( \\log 50 + \\log 2 \\) adalah...", options: [{ text: "2" }, { text: "100" }, { text: "1" }], correct: 0, explanation: "\\( \\log(50 \\times 2) = \\log 100 = 2\\)." },
            { question: "Jika \\( ^2\\log x = 5 \\), maka \\(x\\) adalah...", options: [{ text: "32" }, { text: "10" }, { text: "25" }], correct: 0, explanation: "Ubah ke bentuk eksponen: \\(x=2^5=32\\)." }
        ],
        MOTS: [
            { question: "Nilai dari \\( {^2\\log 48} + {^2\\log 3} - {^2\\log 9} \\) adalah...", options: [{ text: "4" }, { text: "5" }, { text: "16" }], correct: 0, explanation: "Gabungkan: \\( {^2\\log(\\frac{48 \\times 3}{9})} = {^2\\log(\\frac{144}{9})} = {^2\\log 16} = 4\\)." },
            { question: "Nilai dari \\( {^{81}\\log 27} \\) adalah...", options: [{ text: "3/4" }, { text: "4/3" }, { text: "3" }], correct: 0, explanation: "Ubah ke basis 3: \\( {^{3^4}\\log 3^3} = \\frac{3}{4} \\cdot {^3\\log 3} = \\frac{3}{4}\\)." },
            { question: "Jika \\( \\log 3 = x \\) dan \\( \\log 5 = y \\), maka \\( \\log 45 \\) adalah...", options: [{ text: "2x + y" }, { text: "x + 2y" }, { text: "xy+2" }], correct: 0, explanation: "\\( \\log 45 = \\log(9 \\times 5) = \\log(3^2 \\times 5) = \\log(3^2) + \\log 5 = 2\\log 3 + \\log 5 = 2x+y\\)." },
            { question: "Nilai dari \\( \\frac{^3\\log 8}{^3\\log 2} \\) adalah...", options: [{ text: "3" }, { text: "4" }, { text: "Tidak bisa disederhanakan" }], correct: 0, explanation: "Gunakan sifat ganti basis secara terbalik: \\( \\frac{^c\\log b}{^c\\log a} = {^a\\log b} \\). Maka, ekspresi ini menjadi \\( {^2\\log 8} = 3\\)." },
            { question: "Berapakah nilai dari \\( 5^{^{25}\\log 4} \\)?", options: [{ text: "2" }, { text: "4" }, { text: "5" }], correct: 0, explanation: "Ubah basis eksponen dan logaritma agar sama: \\( 5^{^{5^2}\\log 2^2} = 5^{\\frac{2}{2} \\cdot {^5\\log 2}} = 5^{^5\\log 2} = 2\\)." },
            { question: "Sederhanakan: \\( 2 {^3\\log 5} - {^3\\log 25} + {^3\\log 9} \\).", options: [{ text: "2" }, { text: "1" }, { text: "0" }], correct: 0, explanation: "\\( {^3\\log 5^2} - {^3\\log 25} + {^3\\log 9} = {^3\\log 25} - {^3\\log 25} + 2 = 2\\)." },
            { question: "Jika \\( ^a\\log 8 = 3/2 \\), maka nilai \\(a\\) adalah...", options: [{ text: "4" }, { text: "2" }, { text: "16" }], correct: 0, explanation: "Ubah ke bentuk eksponen: \\( a^{3/2} = 8 \\). \\( (a^{1/2})^3 = 2^3 \\). Maka \\( \\sqrt{a} = 2 \\), sehingga \\(a=4\\)." },
            { question: "Nilai dari \\( \\log 25 + \\log 40 \\) adalah...", options: [{ text: "3" }, { text: "2" }, { text: "1000" }], correct: 0, explanation: "\\( \\log(25 \\times 40) = \\log 1000 = 3\\)." },
            { question: "Jika \\( ^4\\log 7 = k \\), maka \\( ^2\\log 7 \\) adalah...", options: [{ text: "2k" }, { text: "k/2" }, { text: "\\(k^2\\)" }], correct: 0, explanation: "\\( ^4\\log 7 = {^{2^2}\\log 7^1} = \\frac{1}{2} {^2\\log 7} \\). Jadi \\( k = \\frac{1}{2} {^2\\log 7} \\), maka \\( {^2\\log 7} = 2k\\)." },
            { question: "Bentuk sederhana dari \\( {^3\\log \\sqrt{27}} \\) adalah...", options: [{ text: "3/2" }, { text: "2/3" }, { text: "3" }], correct: 0, explanation: "\\( \\sqrt{27} = (3^3)^{1/2} = 3^{3/2} \\). Maka, \\( {^3\\log 3^{3/2}} = 3/2\\)." },
            { question: "Nilai dari \\( 10^{2+\\log 3} \\) adalah...", options: [{ text: "300" }, { text: "203" }, { text: "109" }], correct: 0, explanation: "Gunakan sifat eksponen: \\( 10^2 \\cdot 10^{\\log 3} = 100 \\cdot 3 = 300\\)." },
            { question: "Jika \\( {^x\\log 64} = -3 \\), maka \\(x\\) adalah...", options: [{ text: "1/4" }, { text: "4" }, { text: "-4" }], correct: 0, explanation: "Ubah ke eksponen: \\( x^{-3} = 64 \\). \\( 1/x^3 = 64 \\implies x^3 = 1/64 \\). Maka \\(x = 1/4\\)." },
            { question: "Bentuk lain dari \\( \\frac{\\log 8}{\\log 4} \\) adalah...", options: [{ text: "\\( ^4\\log 8 \\)" }, { text: "\\( \\log 2 \\)" }, { text: "2" }], correct: 0, explanation: "Ini adalah sifat ganti basis secara terbalik. Jawabannya adalah \\( {^4\\log 8} \\), yang nilainya 3/2." },
            { question: "Nilai dari \\( \\log(0.01) \\) adalah...", options: [{ text: "-2" }, { text: "2" }, { text: "0.1" }], correct: 0, explanation: "\\( 0.01 = 1/100 = 10^{-2} \\). Maka, \\( \\log(10^{-2}) = -2 \\)." },
            { question: "Jika \\( ^2\\log x = 3 \\), maka \\( ^x\\log 16 \\) adalah...", options: [{ text: "4/3" }, { text: "3/4" }, { text: "2" }], correct: 0, explanation: "Dari \\( ^2\\log x = 3 \\), kita dapatkan \\(x=2^3=8\\). Maka soalnya menjadi \\( ^8\\log 16 = {^{2^3}\\log 2^4} = \\frac{4}{3}\\)." }
        ],
        HOTS: [
            { question: "Nilai dari \\( {^3\\log 4} \\cdot {^4\\log 5} \\cdot {^5\\log 6} \\cdot {^6\\log 7} \\cdot {^7\\log 8} \\cdot {^8\\log 9} \\) adalah...", options: [{ text: "2" }, { text: "3" }, { text: "9" }], correct: 0, explanation: "Gunakan sifat 'rantai' berkali-kali. Seluruh ekspresi disederhanakan menjadi \\( {^3\\log 9} \\), yang nilainya adalah 2." },
            { question: "Jika \\( {^4\\log 5} = p \\) dan \\( {^4\\log 7} = q \\), maka \\( {^4\\log 70} \\) adalah...", options: [{ text: "p + q + 1/2" }, { text: "pq+1/2" }, { text: "p+q-2" }], correct: 0, explanation: "\\( {^4\\log 70} = {^4\\log(2 \\cdot 5 \\cdot 7)} = {^4\\log 2} + {^4\\log 5} + {^4\\log 7} \\). Kita tahu \\( {^4\\log 2} = {^4\\log 4^{1/2}} = 1/2 \\). Maka hasilnya \\( 1/2 + p + q\\)." },
            { question: "Tentukan nilai dari \\( \\frac{\\log(27) + \\log(8) - \\log(125)}{\\log(6) - \\log(5)} \\).", options: [{ text: "3" }, { text: "2" }, { text: "1" }], correct: 0, explanation: "Pembilang: \\( \\log(3^3) + \\log(2^3) - \\log(5^3) = 3(\\log 3 + \\log 2 - \\log 5) = 3(\\log(6/5)) \\). Penyebut: \\( \\log(6/5) \\). Maka, \\( \\frac{3\\log(6/5)}{\\log(6/5)} = 3\\)." },
            { question: "Jika \\( {^a\\log(1-^3\\log(1/27))} = 2 \\), maka nilai \\(a\\) adalah...", options: [{ text: "2" }, { text: "3" }, { text: "4" }], correct: 0, explanation: "Kerjakan dari dalam: \\( {^3\\log(1/27)} = -3 \\). Maka persamaan menjadi \\( {^a\\log(1 - (-3))} = 2 \\implies {^a\\log 4} = 2 \\). Ubah ke eksponen: \\( a^2=4 \\). Karena basis harus positif, \\(a=2\\)." },
            { question: "Diberikan \\( {^2\\log x} + {^4\\log x} + {^{16}\\log x} = 7 \\). Nilai \\(x\\) adalah...", options: [{ text: "64" }, { text: "16" }, { text: "256" }], correct: 0, explanation: "Samakan semua basis ke 2: \\( {^2\\log x} + \\frac{1}{2}{^2\\log x} + \\frac{1}{4}{^2\\log x} = 7 \\). Misal \\( p={^2\\log x} \\), maka \\( (1 + 1/2 + 1/4)p = 7 \\implies (7/4)p=7 \\implies p=4 \\). Jadi, \\( {^2\\log x} = 4 \\implies x=16\\)." },
            { question: "Mana yang lebih besar, \\( A = {^5\\log 6} \\) atau \\( B = {^6\\log 5} \\)?", options: [{ text: "A lebih besar" }, { text: "B lebih besar" }, { text: "Sama besar" }], correct: 0, explanation: "Ingat bahwa \\( {^x\\log y} = 1/{^y\\log x} \\). \\( {^5\\log 6} > 1 \\) karena \\(5^1=5\\). Karena \\( {^5\\log 6} > 1 \\), maka kebalikannya, \\( {^6\\log 5} \\), pasti \\( < 1 \\). Jadi A lebih besar." },
            { question: "Buktikan bahwa \\( {^a\\log b} \cdot {^b\\log c} = {^a\\log c} \\) menggunakan sifat ganti basis.", options: [{ text: "Pembuktian valid" }, { text: "Pembuktian tidak valid" }], correct: 0, explanation: "Ubah semua ke basis 10: \\( \\frac{\\log b}{\\log a} \\cdot \\frac{\\log c}{\\log b} \\). Suku \\( \\log b \\) saling menghilangkan, menyisakan \\( \\frac{\\log c}{\\log a} \\), yang mana sama dengan \\( {^a\\log c} \\). Pernyataan ini valid." },
            { question: "Jika \\( {^2\\log(a^2-b^2)} = 3 \\) dan \\( \\log(a-b)=0 \\), maka \\(a+b\\) adalah...", options: [{ text: "8" }, { text: "4" }, { text: "2" }], correct: 0, explanation: "Dari \\( \\log(a-b)=0 \\), kita dapat \\( a-b=10^0=1 \\). Dari persamaan pertama, \\( {^2\\log((a-b)(a+b))} = 3 \\). Substitusi \\( a-b=1 \\): \\( {^2\\log(1 \\cdot (a+b))} = 3 \\). Maka \\( a+b = 2^3 = 8\\)." },
            { question: "Nilai \\(x\\) yang memenuhi \\( {^x\\log(x+12)} - 3 {^x\\log 4} + 1 = 0 \\) adalah...", options: [{ text: "4" }, { text: "2" }, { text: "16" }], correct: 0, explanation: "Pindahkan 1: \\( {^x\\log(x+12)} - {^x\\log 4^3} = -1 \\implies {^x\\log(\\frac{x+12}{64})} = -1 \\). Ubah ke eksponen: \\( \\frac{x+12}{64} = x^{-1} = \\frac{1}{x} \\). Persamaan kuadratnya \\( x(x+12)=64 \implies x^2+12x-64=0 \implies (x+16)(x-4)=0 \\). Karena basis \\(x\\) harus positif, jawabannya \\(x=4\\)." },
            { question: "Jika \\( 4^x = 5 \\), maka nilai dari \\( ^2\\log 5 \\) adalah...", options: [{ text: "\\(2x\\)" }, { text: "\\(x/2\\)" }, { text: "\\(x^2\\)" }], correct: 0, explanation: "Ambil logaritma basis 2 di kedua sisi persamaan: \\( ^2\\log(4^x) = {^2\\log 5} \\). Gunakan sifat pangkat: \\( x \\cdot {^2\\log 4} = {^2\\log 5} \\). Karena \\( {^2\\log 4}=2 \\), maka \\( 2x = {^2\\log 5} \\)." },
            { question: "Urutkan dari terkecil ke terbesar: \\( A={^2\\log 10} \\), \\( B={^3\\log 10} \\), \\( C={^5\\log 10} \\).", options: [{ text: "C, B, A" }, { text: "A, B, C" }, { text: "B, C, A" }], correct: 0, explanation: "Untuk numerus yang sama (>1), semakin besar basisnya, semakin kecil nilai logaritmanya. \\(5^x=10\\) butuh \\(x\\) paling kecil. \\(2^x=10\\) butuh \\(x\\) paling besar." },
            { question: "Nilai dari \\( \\log \\tan 1^\circ + \\log \\tan 2^\circ + ... + \\log \\tan 89^\circ \\) adalah...", options: [{ text: "0" }, { text: "1" }, { text: "Tidak terhingga" }], correct: 0, explanation: "Gunakan sifat penjumlahan: \\( \\log(\tan 1^\circ \cdot \tan 2^\circ \cdot ... \cdot \tan 89^\circ) \\). Karena \\( \\tan(90-x) = \\cot(x) = 1/\\tan(x) \\), maka \\( \\tan 1^\circ \cdot \tan 89^\circ = 1 \\), \\( \\tan 2^\circ \cdot \tan 88^\circ = 1 \\), dst. Di tengah ada \\( \\tan 45^\circ = 1 \\). Hasil perkalian semua numerus adalah 1. Maka, \\( \\log(1) = 0\\)." },
            { question: "Sederhanakan: \\( \\frac{{^3\\log 12} - {^3\\log 4}}{{^2\\log 8}} \\).", options: [{ text: "1/3" }, { text: "3" }, { text: "1" }], correct: 0, explanation: "Pembilang: \\( {^3\\log(12/4)} = {^3\\log 3} = 1 \\). Penyebut: \\( {^2\\log 8} = 3 \\). Hasilnya adalah 1/3." },
            { question: "Jika \\( {^a\\log b} = 2 \\) dan \\( {^c\\log a} = 3 \\), maka nilai \\( {^c\\log b} \\) adalah...", options: [{ text: "6" }, { text: "5" }, { text: "1.5" }], correct: 0, explanation: "Kita ingin \\( {^c\\log b} \\). Kita tahu \\( {^c\\log b} = {^c\\log a} \cdot {^a\\log b} \\) dari sifat rantai. Substitusi nilainya: \\( 3 \cdot 2 = 6\\)." },
            { question: "Tentukan nilai \\(x\\) dari \\( 7^{^7\\log(x^2-x-1)} = 5 \\).", options: [{ text: "3 dan -2" }, { text: "Hanya 3" }, { text: "Hanya -2" }], correct: 0, explanation: "Gunakan sifat \\( a^{^a\\log b} = b \\). Maka, \\( x^2-x-1 = 5 \\implies x^2-x-6=0 \\implies (x-3)(x+2)=0 \\). Solusinya \\(x=3\\) atau \\(x=-2\\). Kedua solusi ini harus dicek ke syarat numerus. Untuk \\(x=3\\), numerus = 5 > 0 (valid). Untuk \\(x=-2\\), numerus = 5 > 0 (valid). Jadi kedua jawaban benar." }
        ]
    };

    // --- SCRIPT LOGIKA UJIAN ---
    // (Seluruh sisa script dari template Anda akan ditempatkan di sini, tidak perlu diubah)
    function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
    function showNotification(message, type = 'warning') { const container = document.getElementById('notification-container'); const notif = document.createElement('div'); notif.className = `notification ${type}`; let icon = '‚ö†Ô∏è'; if (type === 'success') icon = '‚úÖ'; if (type === 'info') icon = '‚ÑπÔ∏è'; notif.innerHTML = `<span>${icon}</span> <span>${message}</span>`; container.appendChild(notif); setTimeout(() => { notif.remove(); }, 4000); }
    function updateProgress() { const stages = ['step0', 'step1', 'step2', 'step3', 'step4']; const progress = (state.currentStage / 4) * 100; document.getElementById('progressFill').style.width = progress + '%'; stages.forEach((id, idx) => { const step = document.getElementById(id); step.classList.remove('active', 'completed'); if (idx < state.currentStage) step.classList.add('completed'); else if (idx === state.currentStage) step.classList.add('active'); }); const levelNames = ['Materi', 'LOTS', 'MOTS', 'HOTS', 'Selesai']; document.getElementById('currentLevel').textContent = levelNames[state.currentStage]; }
    function startQuiz(level) { state.currentQuiz = level; if (!quizContent[level] || quizContent[level].length < 5) { document.getElementById('contentArea').innerHTML = `<p style="color:red;">Error: Bank Soal '${level}' tidak cukup (kurang dari 5 soal).</p>`; return; } const fullBank = quizContent[level]; const shuffledBank = shuffleArray([...fullBank]); state.activeQuestions = shuffledBank.slice(0, 5); state.userAnswers = Array(state.activeQuestions.length).fill(null); const levelMap = { LOTS: 1, MOTS: 2, HOTS: 3 }; state.currentStage = levelMap[level]; updateProgress(); updateStats(); const content = `<div class="quiz-section active"><h2 style="text-align:center; margin-bottom: 20px;">üìù ${level} - Mode Ujian (5 Soal Acak)</h2><div class="attempts-info"><strong>Percobaan ${6 - state.attempts[level]} dari 5</strong> | Lulus: ${state.passCount[level]}/2 | Gagal beruntun: ${state.consecutiveFails[level]}/3</div><div id="questionsContainer"></div><div class="button-group" id="quiz-button-group"><button id="submitBtn" class="btn btn-primary" onclick="submitQuiz()">Submit Jawaban</button></div></div>`; document.getElementById('contentArea').innerHTML = content; renderQuestions(state.activeQuestions); }
    function renderQuestions(questions) { const container = document.getElementById('questionsContainer'); container.innerHTML = questions.map((q, idx) => { const optionsHTML = q.options.map((opt, optIdx) => `<div class="option" onclick="selectOption(this, ${idx}, ${optIdx})"><input type="radio" name="q${idx}" id="q${idx}opt${optIdx}" style="pointer-events: none;"><label for="q${idx}opt${optIdx}" style="cursor: pointer; width: 100%;">${opt.text}</label></div>`).join(''); return `<div class="question-card" id="question${idx}"><div class="question-number">Soal ${idx + 1} dari ${questions.length}</div><div class="question-text">${q.question}</div><div class="options" style="display:flex; flex-direction:column; gap:10px;">${optionsHTML}</div><div class="explanation hidden" id="explanation${idx}"></div></div>`; }).join(''); setTimeout(() => MathJax.typesetPromise(), 10); }
    function selectOption(element, questionIdx, optionIdx) { if (document.getElementById('submitBtn')?.disabled) return; const options = document.querySelectorAll(`#question${questionIdx} .option`); options.forEach(opt => opt.classList.remove('selected')); element.classList.add('selected'); element.querySelector('input[type="radio"]').checked = true; state.userAnswers[questionIdx] = optionIdx; }
    function submitQuiz() {
        const level = state.currentQuiz;
        const questions = state.activeQuestions;
        const unanswered = state.userAnswers.filter(ans => ans === null).length;
        if (unanswered > 0) {
            showNotification(`Mohon jawab semua soal! Ada ${unanswered} soal yang belum terjawab.`);
            return;
        }
        let correct = 0;
        questions.forEach((q, idx) => {
            const userAnswerIdx = state.userAnswers[idx];
            const isCorrect = (userAnswerIdx === q.correct);
            if (isCorrect) correct++;
            
            const options = document.querySelectorAll(`#question${idx} .option`);
            options.forEach(opt => opt.style.pointerEvents = 'none'); // Menonaktifkan klik setelah submit

            options[userAnswerIdx].classList.add(isCorrect ? 'correct' : 'incorrect');
            if (!isCorrect) {
                options[q.correct].classList.add('correct');
            }
            const explanation = document.getElementById(`explanation${idx}`);
            explanation.innerHTML = `<strong>üí° Pembahasan:</strong> ${q.explanation}`;
            explanation.classList.remove('hidden'); // ‚úÖ PERBAIKAN: Hanya munculkan pembahasan di sini
        });
        setTimeout(() => MathJax.typesetPromise(), 10);
        const score = (correct / questions.length) * 100;
        const passed = score >= 80;
        state.attempts[level]--;
        if (passed) {
            state.passCount[level]++;
            state.consecutiveFails[level] = 0;
            showNotification(`Luar biasa! Skor Anda ${score.toFixed(0)}%.`, 'success');
        } else {
            state.consecutiveFails[level]++;
            showNotification(`Skor Anda ${score.toFixed(0)}%. Coba lagi!`, 'warning');
        }
        updateStats();
        const submitButton = document.getElementById('submitBtn');
        if (submitButton) {
            submitButton.disabled = true;
            submitButton.style.display = 'none';
        }
        document.getElementById('quiz-button-group').innerHTML = `<button class="btn btn-primary" onclick='showResult("${level}", ${score}, ${passed})'>Lihat Hasil</button>`;
    }
    function showResult(level, score, passed) { const canProceed = state.passCount[level] >= 2; const isEliminated = state.consecutiveFails[level] >= 3 || (state.attempts[level] === 0 && !canProceed); let resultHTML = `<div class="result-summary" style="text-align: center;"><h2>${passed ? '‚úÖ Lulus!' : '‚ùå Gagal'} (Minimal Skor: 80%)</h2><div style="font-size: 4em; font-weight: bold; color: ${passed ? 'var(--accent-green)' : 'var(--accent-red)'}; margin: 20px 0;">${score.toFixed(0)}%</div><p style="font-size: 1.2em; margin: 20px 0;">Benar ${Math.round((score / 100) * state.activeQuestions.length)} dari ${state.activeQuestions.length} soal</p><div class="attempts-info"><strong>Status:</strong> Lulus: ${state.passCount[level]}/2 | Sisa Percobaan: ${state.attempts[level]} | Gagal Beruntun: ${state.consecutiveFails[level]}/3</div>`; if (isEliminated) { resultHTML += `<div style="background: rgba(220, 53, 69, 0.2); padding: 20px; border-radius: 10px; margin: 20px 0;"><h3 style="color: var(--accent-red);">‚ùå GUGUR</h3><p style="margin: 15px 0;">Kamu telah ${state.consecutiveFails[level] >= 3 ? 'gagal 3x berturut-turut' : 'kehabisan percobaan'}.</p></div><div class="button-group"><button class="btn btn-secondary" onclick="resetSystem()">Mulai Ulang dari Awal</button></div>`; } else if (canProceed) { const nextLevel = level === 'LOTS' ? 'MOTS' : (level === 'MOTS' ? 'HOTS' : null); if (nextLevel) { resultHTML += `<div style="background: rgba(40, 167, 69, 0.2); padding: 20px; border-radius: 10px; margin: 20px 0;"><h3 style="color: var(--accent-green);">üîì Level ${nextLevel} Terbuka!</h3></div><div class="button-group"><button class="btn btn-primary" onclick="start${nextLevel}()">Lanjut ke ${nextLevel} ‚Üí</button></div>`; } else { resultHTML += generateCertificate(); } } else { resultHTML += `<div class="button-group"><button class="btn btn-primary" onclick="start${level}()">Coba Lagi (${state.attempts[level]} percobaan)</button></div>`; } resultHTML += `</div>`; document.getElementById('contentArea').innerHTML = resultHTML; }
    function generateCertificate() { state.currentStage = 4; updateProgress(); markAsCompletedAndUnlockNext(); return `<div class="certificate"><div style="font-size: 5em;">üèÜ</div><h2 style="font-size: 2.5em; margin-bottom: 20px; color: var(--accent-teal);">Sub-Materi Selesai!</h2><p style="font-size: 1.3em; margin: 20px 0;">SELAMAT!</p><p style="font-size: 1.1em; line-height: 1.6;">Kamu telah berhasil menyelesaikan topik <strong>Sifat-Sifat Logaritma</strong>.</p></div><div class="button-group"><a href="./index.html" class="btn btn-primary">Kembali ke Peta Belajar</a></div>`; }
    function updateStats() { const level = state.currentQuiz || 'LOTS'; document.getElementById('attemptsLeft').textContent = state.attempts[level]; document.getElementById('passCount').textContent = `${state.passCount[level]}/2`; }
    function startLOTS() { startQuiz('LOTS'); }
    function startMOTS() { startQuiz('MOTS'); }
    function startHOTS() { startQuiz('HOTS'); }
    function resetSystem() { window.location.href = './'; }
    
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('step0').classList.add('completed');
        startQuiz('LOTS');
    });
</script>
</body>
</html>
