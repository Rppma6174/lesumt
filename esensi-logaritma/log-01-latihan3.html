<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latihan Soal 3: Esensi Logaritma</title>

    <script>
        // --- KONFIGURASI PENTING UNTUK HALAMAN INI ---
        const subMateriId = 'log_1';      // ID Peta Belajar Induk
        const thisStageId = 'latihan3';   // ID Tahap INI
        const previousStageId = 'latihan2';   // ID Tahap SEBELUMNYA
        const GAS_WEB_APP_URL = "GANTI_DENGAN_URL_APPS_SCRIPT_TERBARU_ANDA";
        // ----------------------------------------------

        (function secureContentPage() {
            document.documentElement.style.visibility = 'hidden';
            const loggedInUserData = sessionStorage.getItem('loggedInUser');
            if (!loggedInUserData) {
                alert("Akses ditolak. Silakan login terlebih dahulu.");
                window.location.href = '../login.html';
                return;
            }
            if (previousStageId) {
                const prevStageKey = `progress_${subMateriId}_${previousStageId}`;
                if (localStorage.getItem(prevStageKey) !== 'completed') {
                    alert("Akses ditolak. Selesaikan tahap sebelumnya pada Peta Belajar.");
                    window.location.href = './index.html'; 
                    return;
                }
            }
            document.documentElement.style.visibility = 'visible';
        })();
    </script>
    <link rel="icon" type="image/png" href="../UMT-Logo - Copy.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
      MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary-purple: #8A2BE2; --dark-bg: #141414; --card-bg: #1c1c1c;
            --border-color: #333; --text-primary: #ffffff; --text-secondary: #ccc;
            --text-muted: #888; --success-color: #28a745; --error-color: #dc3545;
            --warning-color: #ffc107;
        }
        body { background-color: var(--dark-bg); color: var(--text-primary); font-family: 'Poppins', sans-serif; line-height: 1.7; }
        .container { max-width: 800px; margin: 2rem auto; padding: 1.5rem 2rem; background-color: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; }
        .back-link { position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; background-color: var(--primary-purple); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; text-decoration: none; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.2s ease; cursor: pointer; }
        .back-link:hover { transform: scale(1.1); }
        h1, h2 { color: var(--primary-purple); }
        h1 { font-size: 2.2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.75rem; margin-bottom: 1.5rem; font-weight: 700; }
        h2 { font-size: 1.6rem; margin-top: 2.5rem; margin-bottom: 1.5rem; border-left: 4px solid var(--primary-purple); padding-left: 1rem; font-weight: 600; }
        .question-block { border-top: 1px solid var(--border-color); padding-top: 1.5rem; margin-top: 1.5rem; }
        .question-text { font-size: 1.1em; color: var(--text-primary); margin-bottom: 1rem; }
        .question-text strong { color: var(--primary-purple); font-size: 1.2em; margin-right: 0.5rem; }
        .upload-section { background-color: var(--dark-bg); padding: 2rem; border: 1px dashed var(--border-color); border-radius: 10px; margin-top: 2rem; margin-bottom: 1rem; }
        .upload-section h3 { color: var(--primary-purple); margin-bottom: 1rem; font-size: 1.2rem; font-weight: 600; }
        .upload-section p { color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.95rem; }
        .file-upload-input { display: none; }
        .upload-label { display: inline-block; padding: 12px 24px; background-color: var(--primary-purple); color: var(--text-primary); border-radius: 8px; cursor: pointer; transition: background-color 0.2s; font-weight: 500; }
        .upload-label:hover { background-color: #7D2ED1; }
        .file-name-display { display: inline-block; margin-left: 15px; font-size: 0.9em; color: var(--text-muted); font-style: italic; }
        .submit-button { display: block; width: 100%; padding: 15px; background-color: var(--success-color); color: var(--text-primary); border: none; border-radius: 8px; font-size: 18px; font-weight: 600; text-align: center; cursor: pointer; margin-top: 3rem; transition: all 0.3s ease; }
        .submit-button:hover { background-color: #218838; transform: translateY(-2px); }
        .submit-button:disabled { background-color: var(--text-muted); cursor: not-allowed; transform: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; z-index: 2000; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--card-bg); padding: 30px; border-radius: 15px; border: 1px solid var(--border-color); box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5); width: 90%; max-width: 500px; text-align: center; transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-content h3 { margin-top: 0; color: var(--primary-purple); font-weight: 600; font-size: 1.5rem; }
        .modal-content p { color: var(--text-secondary); margin-bottom: 25px; line-height: 1.6; }
        .modal-content ul { text-align: left; color: var(--text-secondary); margin: 20px 0; }
        .modal-content ul li { margin-bottom: 10px; }
        .modal-footer { display: flex; gap: 10px; }
        .modal-footer button, .modal-footer a { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .modal-footer .confirm-btn { background-color: var(--success-color); color: white; }
        .modal-footer .confirm-btn:hover { background-color: #218838; }
        .modal-footer .cancel-btn { background-color: var(--text-muted); color: white; }
        .modal-footer .cancel-btn:hover { background-color: #5a5a5a; }
        .modal-footer .close-btn { background-color: var(--primary-purple); color: white; width: 100%; }
        .modal-footer .close-btn:hover { background-color: #7D2ED1; }
        .warning-icon { font-size: 4rem; color: var(--warning-color); margin-bottom: 1rem; }
        .success-icon { font-size: 4rem; color: var(--success-color); margin-bottom: 1rem; }
        .toast-notification { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500; box-shadow: 0 4px 20px rgba(0,0,0,0.4); transition: top 0.5s ease-in-out; z-index: 3000; }
        .toast-notification.show { top: 20px; }
        .toast-notification.success { background-color: var(--success-color); }
        .toast-notification.error { background-color: var(--error-color); }
        p, li { color: var(--text-secondary); }
    </style>
</head>
<body style="visibility: hidden;">
    <div id="toast" class="toast-notification">Pesan Notifikasi</div>

    <div id="warning-modal" class="modal-overlay active">
        <div class="modal-content">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <h3>PERHATIAN PENTING!</h3>
            <p style="font-size: 1.05rem; font-weight: 500;">Untuk memaksimalkan pembelajaran Anda:</p>
            <ul>
                <li>üö´ <strong>DILARANG KERAS</strong> menggunakan AI (ChatGPT, dll) atau Google untuk mencari jawaban</li>
                <li>üìö Jawablah berdasarkan <strong>pemahaman Anda sendiri</strong> dari materi yang telah dipelajari</li>
                <li>üéØ Paksa diri Anda untuk berpikir dan mengingat materi</li>
            </ul>
            <p style="color: var(--warning-color); font-weight: 600; margin-top: 20px;">Hasil terbaik datang dari usaha Anda sendiri!</p>
            <div class="modal-footer"><button id="close-warning-btn" class="close-btn">Saya Mengerti, Mulai Latihan</button></div>
        </div>
    </div>

    <div id="confirmation-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Konfirmasi Pengiriman</h3>
            <p>Pastikan setiap jawaban dan pembahasan cara yang Anda kirimkan tulisannya sudah jelas dan rapi.</p>
            <div class="modal-footer"><button id="cancel-submit-btn" class="cancel-btn">Batal</button><button id="confirm-submit-btn" class="confirm-btn">Ya, Kirim Sekarang</button></div>
        </div>
    </div>

    <div id="back-warning-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="warning-icon">üö´</div>
            <h3>Tidak Bisa Kembali!</h3>
            <p>Anda belum mengirimkan jawaban. Silakan selesaikan dan kirim jawaban terlebih dahulu sebelum keluar.</p>
            <div class="modal-footer"><button id="close-back-warning-btn" class="close-btn">Mengerti</button></div>
        </div>
    </div>

    <div id="success-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="success-icon">üéâ</div>
            <h3>Selamat! Latihan Selesai</h3>
            <p>Jawaban Anda telah berhasil dikirim. Progress Anda telah disimpan dan tahapan berikutnya sudah terbuka.</p>
            <div class="modal-footer" style="flex-direction: column;">
                <button id="skip-to-roadmap-btn" style="background-color: var(--success-color); color: white; width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;">Lanjut ke Peta Belajar</button>
            </div>
            <p id="countdown-text" style="font-size: 0.85rem; color: var(--text-muted); margin-top: 15px;">Atau tunggu <span id="countdown">10</span> detik...</p>
        </div>
    </div>

    <div class="container">
        <a id="back-link" class="back-link" title="Kembali ke Peta Belajar"><i class="fas fa-arrow-left"></i></a>
        <h1>Latihan Soal 3: Esensi Logaritma</h1>
        <p>Kerjakan soal-soal di bawah ini dengan menuliskan cara kerja dan penjelasan Anda...</p>

        <h2>Soal Level LOTS</h2>
        <div class="question-block"><p class="question-text"><strong>1.</strong> Tentukan nilai dari ${}^2\log 8^5$ tanpa menghitung nilai $8^5$ terlebih dahulu.</p></div>
        <div class="question-block"><p class="question-text"><strong>2.</strong> Jika diketahui ${}^2\log 3 = a$, nyatakan ${}^8\log 3$ dalam bentuk $a$.</p></div>

        <h2>Soal Level MOTS</h2>
        <div class="question-block"><p class="question-text"><strong>3.</strong> Sederhanakan ekspresi berikut: $2 \cdot {}^3\log 6 - {}^3\log 4$.</p></div>
        <div class="question-block"><p class="question-text"><strong>4.</strong> Tentukan nilai $x$ yang memenuhi: $\log(x+2) + \log(x-1) = 1$.</p></div>

        <h2>Soal Level HOTS</h2>
        <div class="question-block"><p class="question-text"><strong>5.</strong> Diberikan $X = {}^{\sqrt{2}}\log 4$ dan $Y = {}^{1/3}\log 27$. Tentukan bilangan mana yang lebih besar.</p></div>
        <div class="question-block"><p class="question-text"><strong>6.</strong> Buktikan bahwa ${}^{a^m}\log b^n = \frac{n}{m} \cdot {}^a\log b$.</p></div>

        <div class="upload-section">
            <h3>üì§ Upload Jawaban Anda</h3>
            <p>Foto atau scan <strong>semua jawaban Anda</strong> untuk soal 1-6 dalam <strong>satu file</strong>...</p>
            <label for="combined_upload" class="upload-label"><i class="fas fa-cloud-upload-alt"></i> Pilih File Jawaban</label>
            <input type="file" id="combined_upload" class="file-upload-input" accept="image/*,.pdf,.doc,.docx">
            <span class="file-name-display">Belum ada file dipilih</span>
        </div>

        <button id="submit-button" class="submit-button">Kirim Jawaban</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Menggunakan variabel dari skrip penjaga di <head>
            const ROADMAP_PATH = './index.html';

            const fileInput = document.getElementById('combined_upload');
            const submitButton = document.getElementById('submit-button');
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmSubmitBtn = document.getElementById('confirm-submit-btn');
            const cancelSubmitBtn = document.getElementById('cancel-submit-btn');
            const warningModal = document.getElementById('warning-modal');
            const closeWarningBtn = document.getElementById('close-warning-btn');
            const backWarningModal = document.getElementById('back-warning-modal');
            const closeBackWarningBtn = document.getElementById('close-back-warning-btn');
            const successModal = document.getElementById('success-modal');
            const skipToRoadmapBtn = document.getElementById('skip-to-roadmap-btn');
            const countdownElement = document.getElementById('countdown');
            const backLink = document.getElementById('back-link');
            const toast = document.getElementById('toast');
            
            let isSubmitted = false;
            let countdownInterval = null;

            closeWarningBtn.addEventListener('click', () => { warningModal.classList.remove('active'); });

            function showNotification(message, type) { /* ... (Sama seperti kode Anda) ... */ }
            fileInput.addEventListener('change', (event) => { /* ... (Sama seperti kode Anda) ... */ });

            backLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (!isSubmitted) { backWarningModal.classList.add('active'); } 
                else { window.location.href = ROADMAP_PATH; }
            });

            closeBackWarningBtn.addEventListener('click', () => { backWarningModal.classList.remove('active'); });

            submitButton.addEventListener('click', () => {
                if (fileInput.files.length === 0) { showNotification('Harap upload file jawaban Anda.', 'error'); return; }
                confirmationModal.classList.add('active');
            });

            cancelSubmitBtn.addEventListener('click', () => confirmationModal.classList.remove('active'));
            confirmationModal.addEventListener('click', (e) => { if (e.target === confirmationModal) { confirmationModal.classList.remove('active'); } });

            confirmSubmitBtn.addEventListener('click', () => {
                confirmationModal.classList.remove('active');
                submitButton.disabled = true;
                submitButton.textContent = 'Mengirim...';
                const formData = new FormData();
                formData.append('jawaban_soal', fileInput.files[0]);
                kirimKeTelegram(formData);
            });

            function markStageCompleted() {
                const storageKey = `progress_${subMateriId}_${thisStageId}`;
                localStorage.setItem(storageKey, 'completed');
            }

            async function kirimKeTelegram(formData) {
                const BOT_TOKEN = '8386335553:AAGDw3mqCWGgZCUL4kUZ198nIb00Jv3tQoQ';
                const CHAT_ID = '6919363709';
                const user = JSON.parse(sessionStorage.getItem('loggedInUser'));
                const namaUser = user ? user.fullName : "Anonim";

                try {
                    const timestamp = new Date().toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'short' });
                    const pesanPembuka = `üìù *LATIHAN SOAL 3: ESENSI LOGARITMA*\n\n` + `üë§ Nama: ${namaUser}\n` + `üïê Waktu: ${timestamp}\n` + `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: CHAT_ID, text: pesanPembuka, parse_mode: 'Markdown' }) });

                    const file = formData.get('jawaban_soal');
                    if (file) {
                        const fileFormData = new FormData();
                        fileFormData.append('chat_id', CHAT_ID);
                        fileFormData.append('document', file);
                        fileFormData.append('caption', `üìÑ Jawaban Lengkap Soal 1-6 - ${namaUser}`);
                        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, { method: 'POST', body: fileFormData });
                        if (!response.ok) throw new Error('Gagal mengirim file');
                    }
                    
                    markStageCompleted(); // <-- Panggil fungsi ini setelah berhasil
                    isSubmitted = true;
                    successModal.classList.add('active');
                    
                    let countdown = 10;
                    countdownElement.textContent = countdown;
                    countdownInterval = setInterval(() => {
                        countdown--;
                        countdownElement.textContent = countdown;
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            window.location.href = ROADMAP_PATH;
                        }
                    }, 1000);

                } catch (error) {
                    console.error('Error:', error);
                    showNotification('Gagal mengirim jawaban. Periksa koneksi atau BOT TOKEN.', 'error');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Kirim Jawaban';
                }
            }

            skipToRoadmapBtn.addEventListener('click', () => {
                clearInterval(countdownInterval);
                window.location.href = ROADMAP_PATH;
            });
        });
    </script>
</body>
</html>
